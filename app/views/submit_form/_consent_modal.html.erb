<% consent_accepted = cookies[:consent_accepted] == 'true' %>
<% unless consent_accepted %>
<div id="consent_overlay" class="fixed inset-0 bg-black bg-opacity-50 z-[100] flex items-center justify-center p-4">
  <div class="bg-base-100 rounded-lg shadow-xl max-w-md w-full p-6">
    <h2 class="text-xl font-bold mb-4"><%= t('consent_required') %></h2>
    <p class="text-base-content/70 mb-4">
      <%= t('before_proceeding_please_review_and_accept_the_terms') %>
    </p>
    
    <div class="mb-4">
      <a href="<%= consent_url %>" target="_blank" class="btn btn-outline btn-sm gap-2">
        <%= svg_icon('external_link', class: 'w-4 h-4') %>
        <%= t('view_document') %>
      </a>
    </div>
    
    <div class="form-control mb-4">
      <label class="cursor-pointer flex items-start gap-3">
        <input type="checkbox" id="consent_checkbox" class="checkbox checkbox-primary mt-1" />
        <span class="label-text text-sm">
          <%= consent_text.presence || t('i_have_read_and_agree_to_the_terms_and_conditions') %>
        </span>
      </label>
    </div>
    
    <button id="consent_accept_btn" class="btn btn-primary w-full btn-disabled" type="button">
      <%= t('continue') %>
    </button>
  </div>
</div>

<script type="text/javascript">
  var consentCheckbox = document.getElementById('consent_checkbox');
  var consentAcceptBtn = document.getElementById('consent_accept_btn');
  var consentOverlay = document.getElementById('consent_overlay');
  
  if (consentCheckbox && consentAcceptBtn) {
    consentCheckbox.addEventListener('change', function(e) {
      if (this.checked) {
        consentAcceptBtn.classList.remove('btn-disabled');
        consentAcceptBtn.removeAttribute('disabled');
      } else {
        consentAcceptBtn.classList.add('btn-disabled');
        consentAcceptBtn.setAttribute('disabled', 'disabled');
      }
    });
    
    consentAcceptBtn.addEventListener('click', function(e) {
      e.preventDefault();
      if (consentCheckbox.checked && consentOverlay) {
        document.cookie = 'consent_accepted=true; path=/; max-age=86400; SameSite=Lax';
        consentOverlay.parentNode.removeChild(consentOverlay);
      }
    });
  }
</script>
<% end %>
